<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pantalla de Bienvenida</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Pantalla de Bienvenida</h1>

  <p id="saludo"></p>
  <p id="hora"></p>
  <p id="mensaje"></p>

  <button id="logoutBtn">Cerrar sesión</button>

  <script>
    const token = localStorage.getItem('token');

    // Si no hay token → no tienes permiso
    if (!token) {
      window.location.href = 'no_permisos.html';
    } else {
      fetch('api/api_welcome.php', {
        method: 'GET',
        headers: {
          'Authorization': 'Bearer ' + token
        }
      })
      .then(response => {
        if (response.ok) {
          return response.json();
        } else if (response.status === 403 || response.status === 401) {
          // Sin permisos → redirigir a no_permisos
          window.location.href = 'no_permisos.html';
          throw new Error('No tienes permisos');
        } else {
          throw new Error('Error del servidor');
        }
      })
      .then(data => {
        document.getElementById('saludo').textContent =
          'Hola, ' + data.username;

        document.getElementById('hora').textContent =
          'Hora actual del servidor: ' + data.horaServidor;

        document.getElementById('mensaje').textContent =
          data.message + ' ¡Disfruta de la aplicación!';

        // Opcional: actualización de hora del cliente
        setInterval(() => {
          const ahora = new Date();
          document.getElementById('hora').textContent =
            'Hora actual (cliente): ' + ahora.toLocaleTimeString();
        }, 1000);
      })
      .catch(err => {
        console.error(err);
      });
    }

    // Cerrar sesión
    document.getElementById('logoutBtn').addEventListener('click', function () {
      localStorage.removeItem('token');
      localStorage.removeItem('username');
      window.location.href = 'index.html';
    });
  </script>
</body>
</html>
